# ScavengerBackupProxmox

–£—Ç–∏–ª–∏—Ç–∞ –Ω–∞ Python –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ Proxmox VE. –ü–æ–º–æ–≥–∞–µ—Ç –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –±—ç–∫–∞–ø–∞–º–∏ Proxmox
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±—ç–∫–∞–ø–æ–≤ –ø–æ VM ID
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º—ã–µ –Ω–æ–≤—ã–µ)
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (.log, .notes)
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º dry-run (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è)
- –ü–æ–¥—Å—á—ë—Ç –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º–æ–≥–æ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.6+
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python (argparse, re, pathlib, datetime, collections)
- –ü—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—ç–∫–∞–ø–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/yourusername/ScavengerBackupProxmox.git
cd ScavengerBackupProxmox
```

2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x main.py
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ (dry-run —Ä–µ–∂–∏–º, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Å—Ç–∞–≤–ª—è–µ—Ç 3 –±—ç–∫–∞–ø–∞)
python3 main.py /mnt/pve/Backup/dump

# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–º–æ—â—å
python3 main.py --help
```

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```bash
# –û—Å—Ç–∞–≤–∏—Ç—å 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π VM (—Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å)
python3 main.py /mnt/pve/Backup/dump --keep 5

# –†–µ–∞–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã, –æ—Å—Ç–∞–≤–∏–≤ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
python3 main.py /mnt/pve/Backup/dump --execute

# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ 2 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–∞ –∏ —Ä–µ–∞–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ
python3 main.py /mnt/pve/Backup/dump --keep 2 --execute

# –ö–æ—Ä–æ—Ç–∫–∏–µ –æ–ø—Ü–∏–∏
python3 main.py /mnt/pve/Backup/dump -k 5 -e
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ö–æ—Ä–æ—Ç–∫–∞—è —Ñ–æ—Ä–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------------|----------|--------------|
| `backup_dir` | - | –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –±—ç–∫–∞–ø–∞–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) | - |
| `--keep` | `-k` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è | 3 |
| `--execute` | `-e` | –†–µ–∞–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã (–±–µ–∑ —Ñ–ª–∞–≥–∞ - —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å) | False |

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£—Ç–∏–ª–∏—Ç–∞ –∏—â–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã `*.vma.zst` –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. **–ü–∞—Ä—Å–∏–Ω–≥**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç VM ID –∏ –¥–∞—Ç—É –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (—Ñ–æ—Ä–º–∞—Ç: `vzdump-qemu-VMID-YYYY_MM_DD-HH_MM_SS.vma.zst`)
3. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**: –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –±—ç–∫–∞–ø—ã –ø–æ VM ID
4. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –±—ç–∫–∞–ø—ã –∫–∞–∂–¥–æ–π VM –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ ‚Üí —Å—Ç–∞—Ä—ã–µ)
5. **–í—ã–±–æ—Ä**: –û—Å—Ç–∞–≤–ª—è–µ—Ç N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–º–µ—á–∞–µ—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
6. **–£–¥–∞–ª–µ–Ω–∏–µ**: –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.log, .notes)

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
–î–µ—Ä–∏–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤–µ—Ç
–ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ –±—ç–∫–∞–ø–æ–≤: 45

–ë—ç–∫–∞–ø–æ–≤ –ø–æ VM:
  VM 102: 1 –±—ç–∫–∞–ø–æ–≤
  VM 104: 1 –±—ç–∫–∞–ø–æ–≤
  VM 105: 5 –±—ç–∫–∞–ø–æ–≤
  VM 1100: 3 –±—ç–∫–∞–ø–æ–≤
  VM 1110: 3 –±—ç–∫–∞–ø–æ–≤
  VM 115: 17 –±—ç–∫–∞–ø–æ–≤

 –ù–∞–π–¥–µ–Ω–æ 17 —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
   (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–ª—è –∫–∞–∂–¥–æ–π VM)

  VM 105 | 2025-08-25 04:00:01 | vzdump-qemu-105-2025_08_25-04_00_01.vma.zst
    [DRY RUN] –£–¥–∞–ª–∏—Ç—å: vzdump-qemu-105-2025_08_25-04_00_01.vma.zst
    [DRY RUN] –£–¥–∞–ª–∏—Ç—å: vzdump-qemu-105-2025_08_25-04_00_01.log
    [DRY RUN] –£–¥–∞–ª–∏—Ç—å: vzdump-qemu-105-2025_08_25-04_00_01.vma.zst.notes
  ...

üíæ –í—Å–µ–≥–æ –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ: 238.45 GB

‚ö†Ô∏è  –≠—Ç–æ –±—ã–ª –ø—Ä–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫ (dry-run)!
   –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ --execute
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ **dry-run** (–Ω–µ —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã)
- –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ñ–ª–∞–≥ `--execute`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ `--execute` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏:

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º crontab
crontab -e

# –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 —É—Ç—Ä–∞, –æ—Å—Ç–∞–≤–ª—è–µ–º 5 –±—ç–∫–∞–ø–æ–≤)
0 3 * * * /usr/bin/python3 /root/ScavengerBackupProxmox/main.py /mnt/pve/Backup/dump --keep 5 --execute >> /var/log/backup-cleanup.log 2>&1
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ScavengerBackupProxmox/
‚îú‚îÄ‚îÄ main.py           # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
‚îî‚îÄ‚îÄ README.md         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –§—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ

### `parse_backup_filename(filename)`
–ü–∞—Ä—Å–∏—Ç –∏–º—è —Ñ–∞–π–ª–∞ –±—ç–∫–∞–ø–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- `vm_type` - —Ç–∏–ø VM (qemu –∏–ª–∏ lxc)
- `vm_id` - ID –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
- `timestamp` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞

### `delete_backup_files(backup_file, dry_run=True)`
–£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.log, .notes):
- –ü–∞—Ä–∞–º–µ—Ç—Ä `dry_run=True` - —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –±–∞–π—Ç–∞—Ö

### `main()`
–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã:
1. –ü–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
3. –°–∫–∞–Ω–∏—Ä—É–µ—Ç –∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –±—ç–∫–∞–ø—ã
4. –ù–∞—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã
5. –£–¥–∞–ª—è–µ—Ç –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

–£—Ç–∏–ª–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±—ç–∫–∞–ø–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Proxmox VE:
- `vzdump-qemu-VMID-YYYY_MM_DD-HH_MM_SS.vma.zst` - –∞—Ä—Ö–∏–≤ –±—ç–∫–∞–ø–∞
- `vzdump-qemu-VMID-YYYY_MM_DD-HH_MM_SS.log` - –ª–æ–≥ —Ñ–∞–π–ª
- `vzdump-qemu-VMID-YYYY_MM_DD-HH_MM_SS.vma.zst.notes` - —Ñ–∞–π–ª –∑–∞–º–µ—Ç–æ–∫

–¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è LXC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
- `vzdump-lxc-VMID-YYYY_MM_DD-HH_MM_SS.vma.zst`

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—ç–∫–∞–ø–∞–º–∏ Proxmox VE

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤—ã –Ω–∞—à–ª–∏ –±–∞–≥ –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
